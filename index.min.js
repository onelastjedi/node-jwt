var h=require("node:crypto"),f=(e,r)=>a=>a.replace(e,r),y=f(/=/g,""),b=e=>e.split("."),l=(e,r)=>a=>a.slice(e,r),w=e=>[l(0,2)(e),l(2)(e)],p=e=>y(btoa(D(e))),d=e=>H(atob(e)),x=e=>e/1e3,c=e=>Math.floor(x(e.now())),S=e=>c(Date)+e,D=JSON.stringify,H=JSON.parse,s=class extends Error{constructor(r){super(r),this.name=this.constructor.name}},m=e=>r=>a=>h.createHmac(e,r).update(a).digest("base64url"),v=e=>{var[r,a]=w(e);return{HS:t=>m("sha"+t)}[r](a)},J=e=>p({alg:e,typ:"JWT"});function $({exp:e,...r},a,t="HS256"){var i=J(t),n=p({...r,iat:c(Date),...e&&{exp:S(e)}}),o=v(t)(a);return`${i}.${n}.${o(i+"."+n)}`}function N(e,r){var[a,t,i]=b(e),{alg:n}=d(a),o=v(n)(r),g=i!==o(a+"."+t),u=d(t).exp<=c(Date);if(g)throw new s("Invalid signature");if(u)throw new s("Token expired");return{...d(t)}}module.exports={sign:$,verify:N};
